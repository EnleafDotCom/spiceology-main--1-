<script src="{{ 'component-filter-and-sort.js' | asset_url }}"></script>

{% assign collection_list = shop.metaobjects['featured_collections']['featured-collections-main'] %}
{% assign promo_block = collection.metafields.custom.promo_block.value %}
{% assign current_collection_handle = collection.handle %}
<div
  class="collection section-p-b overflow-x-hidden"
  x-data=filterAndSort
  x-cloak
  x-bind="updateForm"
  x-init="initializeData('{{ collection.sort_by }}', 'collections', '{{ collection.handle }}')"
>
  <div class="px-4 pt-5 text-left lg:px-5">
    <div class="hidden md:block utility-sm pb-[30px] text-opacity-50">
      <a class=" hover:underline" href="/collections/all">Shop all</a>
      â€¦
      <span>{{ collection.title }}</span>
    </div>
    <h1 class="heading-xl pb-2.5">{{ collection.title }}</h1>
    <div class="body-md w-[312px] pb-6">{{ collection.description }}</div>
    <hr>
  </div>
  <form class="" x-ref="filter_form">
    <!-- set x-data for filterPanel -->
    <div class="relative" style="animation: fadeIn 400ms ease-in-out">
      <h2 id="filter-heading" class="sr-only">Filters</h2>
      <div class="relative">
        {% if collection.handle == 'blends' or collection.handle == 'traditional-blends' or collection.handle == 'signature-blends' or collection.handle == 'all-pantry' or collection.handle == 'salt-free-blends' %}
          <div class="lg:py-0.5 overflow-scroll hide-scrollbars relative lg:absolute lg:top-1/2 lg:left-1/2 lg:transform lg:-translate-x-1/2 lg:-translate-y-1/2 lg:min-w-[50vw] h-fit flex flex-no-wrap lg:flex-wrap justify-start lg:justify-center items-center gap-[5px] lg:gap-2 pt-2.5 px-2.5 pb-8  z-50">
            {% assign collection_handle = collection.handle %}
            {% if collection_handle == 'blends' or collection.handle == 'traditional-blends' or collection.handle == 'signature-blends' or collection.handle == 'salt-free-blends' %}
              {% for collection in collection_list.list.value %}
                {% if collection.handle == 'blends' or collection.handle == 'traditional-blends' or collection.handle == 'signature-blends' or collection.handle == 'salt-free-blends' %}
                  <a 
                    href="{{ collection.url }}"
                    :class="window.location.pathname === '/collections/{{ collection.title | handleize }}' ? 'bg-black text-white' : 'bg-white text-black'" 
                    class="hover:-translate-y-0.5 transition heading-sm flex items-center h-[36px] text-[20px] px-4 rounded-[28px] w-max"
                  >
                    <span class="w-max">{{ collection.title }}</span>
                    {% unless collection.handle == "blends" and current_collection_handle == "signature-blends" %}
                      <sup class="utility-lg opacity-75 ml-1 pt-3">{{ collection.products_count }}</sup>
                    {% endunless %}
                  </a>
                {% endif %}
              {% endfor %}
            {% endif %}

            {% if collection_handle != 'blends' and collection.handle != 'traditional-blends' and collection.handle != 'signature-blends' and collection.handle != 'salt-free-blends' %}
              {% for collection in collection_list.list.value %}
                <a 
                  href="{{ collection.url }}"
                  :class="window.location.pathname === '/collections/{{ collection.title | handleize }}' ? 'bg-black text-white' : 'bg-white text-black'" 
                  class="hover:-translate-y-0.5 transition heading-sm flex items-center h-[36px] text-[20px] px-4 rounded-[28px] w-max"
                >
                  <span class="w-max">{{ collection.title }}</span>
                  {% unless collection.handle == "blends" and current_collection_handle == "signature-blends" %}
                    <sup class="utility-lg opacity-75 ml-1 pt-3">{{ collection.products_count }}</sup>
                  {% endunless %}
                </a>
              {% endfor %}
            {% endif %}
          </div>
        {% endif %}

        {% if collection.handle == 'all' %}
          <div class="lg:py-0.5 overflow-scroll hide-scrollbars relative lg:absolute lg:top-1/2 lg:left-1/2 lg:transform lg:-translate-x-1/2 lg:-translate-y-1/2 lg:min-w-[50vw] h-fit flex flex-no-wrap lg:flex-wrap justify-start lg:justify-center items-center gap-[5px] lg:gap-2 pt-2.5 px-2.5 pb-8  z-50">
            {% assign subCollection = collections['blends'] %}
            <a 
              href="{{ subCollection.url }}"
              :class="window.location.pathname === '/collections/{{ subCollection.title | handleize }}' ? 'bg-black text-white' : 'bg-white text-black'" 
              class="hover:-translate-y-0.5 transition heading-sm flex items-center h-[36px] text-[20px] px-4 rounded-[28px] w-max"
            >
              <span class="w-max">{{ subCollection.title }}</span>
                <sup class="utility-lg opacity-75 ml-1 pt-3">{{ subCollection.products_count }}</sup>
            </a>

            {% assign subCollection = collections['chiles'] %}
            <a 
              href="{{ subCollection.url }}"
              :class="window.location.pathname === '/collections/{{ subCollection.title | handleize }}' ? 'bg-black text-white' : 'bg-white text-black'" 
              class="hover:-translate-y-0.5 transition heading-sm flex items-center h-[36px] text-[20px] px-4 rounded-[28px] w-max"
            >
              <span class="w-max">{{ subCollection.title }}</span>
                <sup class="utility-lg opacity-75 ml-1 pt-3">{{ subCollection.products_count }}</sup>
            </a>

            {% assign subCollection = collections['confections'] %}
            <a 
              href="{{ subCollection.url }}"
              :class="window.location.pathname === '/collections/{{ subCollection.title | handleize }}' ? 'bg-black text-white' : 'bg-white text-black'" 
              class="hover:-translate-y-0.5 transition heading-sm flex items-center h-[36px] text-[20px] px-4 rounded-[28px] w-max"
            >
              <span class="w-max">{{ subCollection.title }}</span>
                <sup class="utility-lg opacity-75 ml-1 pt-3">{{ subCollection.products_count }}</sup>
            </a>

            {% assign subCollection = collections['herbs'] %}
            <a 
              href="{{ subCollection.url }}"
              :class="window.location.pathname === '/collections/{{ subCollection.title | handleize }}' ? 'bg-black text-white' : 'bg-white text-black'" 
              class="hover:-translate-y-0.5 transition heading-sm flex items-center h-[36px] text-[20px] px-4 rounded-[28px] w-max"
            >
              <span class="w-max">{{ subCollection.title }}</span>
                <sup class="utility-lg opacity-75 ml-1 pt-3">{{ subCollection.products_count }}</sup>
            </a>

            {% assign subCollection = collections['modernist'] %}
            <a 
              href="{{ subCollection.url }}"
              :class="window.location.pathname === '/collections/{{ subCollection.title | handleize }}' ? 'bg-black text-white' : 'bg-white text-black'" 
              class="hover:-translate-y-0.5 transition heading-sm flex items-center h-[36px] text-[20px] px-4 rounded-[28px] w-max"
            >
              <span class="w-max">{{ subCollection.title }}</span>
                <sup class="utility-lg opacity-75 ml-1 pt-3">{{ subCollection.products_count }}</sup>
            </a>

            {% assign subCollection = collections['veg-powders'] %}
            <a 
              href="{{ subCollection.url }}"
              :class="window.location.pathname === '/collections/{{ subCollection.title | handleize }}' ? 'bg-black text-white' : 'bg-white text-black'" 
              class="hover:-translate-y-0.5 transition heading-sm flex items-center h-[36px] text-[20px] px-4 rounded-[28px] w-max"
            >
              <span class="w-max">{{ subCollection.title }}</span>
                <sup class="utility-lg opacity-75 ml-1 pt-3">{{ subCollection.products_count }}</sup>
            </a>

            {% assign subCollection = collections['salts'] %}
            <a 
              href="{{ subCollection.url }}"
              :class="window.location.pathname === '/collections/{{ subCollection.title | handleize }}' ? 'bg-black text-white' : 'bg-white text-black'" 
              class="hover:-translate-y-0.5 transition heading-sm flex items-center h-[36px] text-[20px] px-4 rounded-[28px] w-max"
            >
              <span class="w-max">{{ subCollection.title }}</span>
                <sup class="utility-lg opacity-75 ml-1 pt-3">{{ subCollection.products_count }}</sup>
            </a>

            {% assign subCollection = collections['sauce'] %}
            <a 
              href="{{ subCollection.url }}"
              :class="window.location.pathname === '/collections/{{ subCollection.title | handleize }}' ? 'bg-black text-white' : 'bg-white text-black'" 
              class="hover:-translate-y-0.5 transition heading-sm flex items-center h-[36px] text-[20px] px-4 rounded-[28px] w-max"
            >
              <span class="w-max">{{ subCollection.title }}</span>
                <sup class="utility-lg opacity-75 ml-1 pt-3">{{ subCollection.products_count }}</sup>
            </a>

            {% assign subCollection = collections['spices'] %}
            <a 
              href="{{ subCollection.url }}"
              :class="window.location.pathname === '/collections/{{ subCollection.title | handleize }}' ? 'bg-black text-white' : 'bg-white text-black'" 
              class="hover:-translate-y-0.5 transition heading-sm flex items-center h-[36px] text-[20px] px-4 rounded-[28px] w-max"
            >
              <span class="w-max">{{ subCollection.title }}</span>
                <sup class="utility-lg opacity-75 ml-1 pt-3">{{ subCollection.products_count }}</sup>
            </a>

            {% assign subCollection = collections['gift-packs'] %}
            <a 
              href="{{ subCollection.url }}"
              :class="window.location.pathname === '/collections/{{ subCollection.title | handleize }}' ? 'bg-black text-white' : 'bg-white text-black'" 
              class="hover:-translate-y-0.5 transition heading-sm flex items-center h-[36px] text-[20px] px-4 rounded-[28px] w-max"
            >
              <span class="w-max">{{ subCollection.title }}</span>
                <sup class="utility-lg opacity-75 ml-1 pt-3">{{ subCollection.products_count }}</sup>
            </a>
          </div>
        {% endif %}
        <div aria-labelledby="filter-heading" class="grid grid-cols-2 lg:flex lg:justify-between lg:items-center gap-[1px] px-2.5 lg:px-5 py-2.5 lg:py-[30px] relative">
          {% render 'collection__filter-toggle' %}
          {% render 'collection__sort' %}
        </div>
      </div>
      <div class="absolute left-2.5 lg:left-5 w-full lg:w-[calc(100vw-40px)] z-10 transform -translate-y-[9px] md:transform-none md:translate-y-0 pointer-events-none">
        <div class="flex w-full">
          <div class="w-full xl:w-[calc(25%-20px)] pointer-events-auto">
            {% render 'collection__filter-panel' %}
          </div>
        </div>
      </div>
    </div>
  </form>
  <div id="productGridContainer" class="transition-opacity duration-300 px-2.5 lg:px-5" :class="{'opacity-50': loading }">
    {% if promo_block %}
      {% assign paginate_count = 18 %}
      {% else %}
      {% assign paginate_count = 20 %}
    {% endif %}
    {% paginate collection.products by paginate_count %}
      <div :class="filtersOpen ? 'xl:grid-cols-3 xl:pl-[25%]' : 'xl:grid-cols-4'" class="product-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-5 gap-y-7 transition-all ease-in-out">
        {% for product in collection.products %}
          {% if promo_block and promo_block.index == forloop.index %}
            <a href="{{ promo_block.link }}" class="col-span-1 md:col-span-2 flex justify-center items-end w-full aspect-[1.3] lg:h-auto lg:aspect-[unset] relative text-white p-10">
              {% if promo_block.asset.value.media_type == "video" %}
                {% for source in promo_block.asset.value.sources %}
                  {% if source.format == 'mp4' %}
                    {% assign url = source.url %}
                  {% endif %}
                {% endfor %}
                <video
                  class="absolute inset-0 w-full h-full object-cover z-[-1] rounded-6"
                  src="{{ url }}"
                  playsinline
                  muted
                  loop
                  autoplay
                ></video>
              {% else %}
                <img class="absolute inset-0 w-full h-full object-cover z-[-1] rounded-6" src="{{ promo_block.asset.value | image_url: width: 1000 }}" />
              {% endif %} 
              <div class="absolute top-6 lg:top-1/3 left-1/2 transform -translate-x-1/2 flex flex-col items-center justify-center px-12 md:px-[100px] w-full">
                <h6 class="utility-sm uppercase pb-2.5">{{ promo_block.eyebrow }}</h6>
                <h5 class="heading-lg md:heading-2xl text-center">{{ promo_block.heading }}</h5>
              </div>
              <button class="button__secondary">{{ promo_block.link_text }}</button>
            </a>
          {% endif %}
          <div class="col-span-1">
            <div class="h-full">
              {%- render 'product__card', product: product, collection: collection -%}
            </div>
          </div>
        {% endfor %}
      </div>

      {% render 'paginate', paginate: paginate %}
    {% endpaginate %}
  </div>
</div>

{% schema %}
{
  "name": "Collection",
  "tag": "section",
  "settings": []
}
{% endschema %}
