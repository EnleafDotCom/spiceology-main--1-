document.addEventListener("alpine:init",(()=>{Alpine.data("filterAndSort",(()=>({activeFilters:{},filterCount:0,filtersOpen:!1,sortOpen:!1,sortBy:null,sortByLabel:null,collectionHandle:null,pageType:null,searchParams:null,loading:!1,productCount:null,toggleFilterPanel(){this.filtersOpen=!this.filtersOpen,this.filtersOpen?this.$nextTick((()=>this.$refs.filtersPanel.focus())):this.$nextTick((()=>this.$refs.filtersButton.focus()))},toggleSortMenu(){this.sortOpen=!this.sortOpen,this.filtersOpen=!1,this.sortOpen?this.$nextTick((()=>this.$refs.sortMenu.focus())):this.$nextTick((()=>this.$refs.sortButton.focus()))},countTotalFilters(t){let e=0;return Object.values(this.activeFilters).forEach((t=>{e+=t.length})),e},handleFilterValueClick(t,e){this.activeFilters[t]?this.activeFilters[t].includes(e)?(this.activeFilters[t]=this.activeFilters[t].filter((t=>t!==e)),0===this.activeFilters[t].length&&delete this.activeFilters[t]):this.activeFilters[t].push(e):this.activeFilters[t]=[e],this.filterCount=this.countTotalFilters(this.activeFilters)},handleChipClick(t){this.$refs[`filter-${t}`].click()},handleKeydownPill(t){t.click(),t.focus()},handleClearFilters(){this.activeFilters={},this.$refs.filter_form.reset(),this.$dispatch("filter-updated"),this.filterCount=0},sortCollection(t,e){this.sortBy=t,this.sortByLabel=e,this.sortOpen=!1},setSortByLabel(t,e){t===this.sortBy&&(this.sortByLabel=e)},updateForm:{"@filter-updated.window"(){const t=this.$refs.filter_form;this.$nextTick((()=>{const e=new FormData(t);for(let[t,i]of Array.from(e.entries()))""===i&&e.delete(t);const i=new URLSearchParams(e).toString();let s;this.loading=!0,"collections"===this.pageType&&(s=`/${this.pageType}/${this.collectionHandle}?${i}`),"search"===this.pageType&&(s=`/${this.pageType}?${this.searchParams}&${i}`),fetch(s).then((t=>t.text())).then((t=>{let e=document.createElement("div");e.innerHTML=t;let s=e.querySelector("#productGridContainer").innerHTML;document.querySelector("#productGridContainer").innerHTML=s,"collections"===this.pageType&&history.replaceState(null,null,"?"+i),"search"===this.pageType&&history.replaceState(null,null,`?${this.searchParams}&${i}`)})).catch((t=>console.error("Error:",t))).finally((()=>this.loading=!1))}))}},getCountLabel(t){return 1===this.productCount?`${this.productCount} ${t}`:`${this.productCount} ${t}s`},initializeData(t,e,i){if(this.sortBy=t,this.collectionHandle=i,this.pageType=e,"search"===e){const t=new URLSearchParams(location.search);for(const[e,i]of t)"q"===e&&i&&(this.searchParams=`q=${i.replace(/\s+/g,"+")}`)}}})))}));